<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ProdutorController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">sistema-agricultura</a> &gt; <a href="index.source.html" class="el_package">com.agricultura.sistema.controller</a> &gt; <span class="el_source">ProdutorController.java</span></div><h1>ProdutorController.java</h1><pre class="source lang-java linenums">package com.agricultura.sistema.controller;

import com.agricultura.sistema.model.Produtor;
import com.agricultura.sistema.service.ProdutorService;
import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.fxml.FXML;
import javafx.scene.control.Alert;
import javafx.scene.control.ButtonType;
import javafx.scene.control.TableColumn;
import javafx.scene.control.TableView;
import javafx.scene.control.TextField;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import java.util.Optional;

@Component
<span class="fc" id="L19">public class ProdutorController {</span>

    @Autowired
    private ProdutorService produtorService;

    @FXML
    private TextField txtNome;
    @FXML
    private TextField txtApelido;
    @FXML
    private TextField txtCpf;
    @FXML
    private TextField txtRegiao;
    @FXML
    private TextField txtReferencia;
    @FXML
    private TextField txtTelefone;

    @FXML
    private TableView&lt;Produtor&gt; tabelaProdutores;

    @FXML
    private TableColumn&lt;Produtor, Long&gt; colId;
    @FXML
    private TableColumn&lt;Produtor, String&gt; colNome;
    @FXML
    private TableColumn&lt;Produtor, String&gt; colApelido;
    @FXML
    private TableColumn&lt;Produtor, String&gt; colCpf;
    @FXML
    private TableColumn&lt;Produtor, String&gt; colRegiao;
    @FXML
    private TableColumn&lt;Produtor, String&gt; colTelefone;

<span class="fc" id="L53">    private ObservableList&lt;Produtor&gt; listaProdutores = FXCollections.observableArrayList();</span>

    private Produtor produtorAtual;

    @FXML
    public void initialize() {
<span class="fc" id="L59">        carregarProdutores();</span>

        // Listener para seleção na tabela (opcional, mas bom pra UX)
<span class="fc" id="L62">        tabelaProdutores.getSelectionModel().selectedItemProperty().addListener((obs, oldSelection, newSelection) -&gt; {</span>
<span class="nc bnc" id="L63" title="All 2 branches missed.">            if (newSelection != null) {</span>
                // Pode preencher o form automaticamente ao selecionar, se desejar
                // preencherFormulario(newSelection);
            }
<span class="nc" id="L67">        });</span>
<span class="fc" id="L68">    }</span>

    private void carregarProdutores() {
<span class="fc" id="L71">        listaProdutores.clear();</span>
<span class="fc" id="L72">        listaProdutores.addAll(produtorService.listarTodos());</span>
<span class="fc" id="L73">        tabelaProdutores.setItems(listaProdutores);</span>
<span class="fc" id="L74">    }</span>

    @FXML
    public void onSalvar() {
<span class="nc bnc" id="L78" title="All 2 branches missed.">        if (produtorAtual == null) {</span>
<span class="nc" id="L79">            produtorAtual = new Produtor();</span>
        }

<span class="nc" id="L82">        produtorAtual.setNome(txtNome.getText());</span>
<span class="nc" id="L83">        produtorAtual.setApelido(txtApelido.getText());</span>
<span class="nc" id="L84">        produtorAtual.setCpf(txtCpf.getText());</span>
<span class="nc" id="L85">        produtorAtual.setRegiao(txtRegiao.getText());</span>
<span class="nc" id="L86">        produtorAtual.setReferencia(txtReferencia.getText());</span>
<span class="nc" id="L87">        produtorAtual.setTelefone(txtTelefone.getText());</span>

        try {
<span class="nc bnc" id="L90" title="All 2 branches missed.">            if (produtorAtual.getId() == null) {</span>
<span class="nc" id="L91">                produtorService.create(produtorAtual);</span>
            } else {
<span class="nc" id="L93">                produtorService.update(produtorAtual.getId(), produtorAtual);</span>
            }
<span class="nc" id="L95">            mostrarAlerta(&quot;Sucesso&quot;, &quot;Produtor salvo com sucesso!&quot;, Alert.AlertType.INFORMATION);</span>
<span class="nc" id="L96">            limparFormulario();</span>
<span class="nc" id="L97">            carregarProdutores();</span>
<span class="nc" id="L98">        } catch (Exception e) {</span>
<span class="nc" id="L99">            mostrarAlerta(&quot;Erro&quot;, &quot;Erro ao salvar produtor: &quot; + e.getMessage(), Alert.AlertType.ERROR);</span>
<span class="nc" id="L100">        }</span>
<span class="nc" id="L101">    }</span>

    @FXML
    public void onEditar() {
<span class="nc" id="L105">        Produtor selecionado = tabelaProdutores.getSelectionModel().getSelectedItem();</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">        if (selecionado != null) {</span>
<span class="nc" id="L107">            preencherFormulario(selecionado);</span>
        } else {
<span class="nc" id="L109">            mostrarAlerta(&quot;Aviso&quot;, &quot;Selecione um produtor para editar.&quot;, Alert.AlertType.WARNING);</span>
        }
<span class="nc" id="L111">    }</span>

    @FXML
    public void onExcluir() {
<span class="nc" id="L115">        Produtor selecionado = tabelaProdutores.getSelectionModel().getSelectedItem();</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">        if (selecionado != null) {</span>
<span class="nc" id="L117">            Alert alert = new Alert(Alert.AlertType.CONFIRMATION);</span>
<span class="nc" id="L118">            alert.setTitle(&quot;Confirmação de Exclusão&quot;);</span>
<span class="nc" id="L119">            alert.setHeaderText(&quot;Excluir Produtor&quot;);</span>
<span class="nc" id="L120">            alert.setContentText(&quot;Tem certeza que deseja excluir o produtor &quot; + selecionado.getNome() + &quot;?&quot;);</span>

<span class="nc" id="L122">            Optional&lt;ButtonType&gt; result = alert.showAndWait();</span>
<span class="nc bnc" id="L123" title="All 4 branches missed.">            if (result.isPresent() &amp;&amp; result.get() == ButtonType.OK) {</span>
                try {
<span class="nc" id="L125">                    produtorService.delete(selecionado.getId());</span>
<span class="nc" id="L126">                    carregarProdutores();</span>
<span class="nc" id="L127">                    limparFormularioIfSelected(selecionado);</span>
<span class="nc" id="L128">                    mostrarAlerta(&quot;Sucesso&quot;, &quot;Produtor excluído com sucesso!&quot;, Alert.AlertType.INFORMATION);</span>
<span class="nc" id="L129">                } catch (Exception e) {</span>
<span class="nc" id="L130">                    mostrarAlerta(&quot;Erro&quot;, &quot;Erro ao excluir produtor: &quot; + e.getMessage(), Alert.AlertType.ERROR);</span>
<span class="nc" id="L131">                }</span>
            }
<span class="nc" id="L133">        } else {</span>
<span class="nc" id="L134">            mostrarAlerta(&quot;Aviso&quot;, &quot;Selecione um produtor para excluir.&quot;, Alert.AlertType.WARNING);</span>
        }
<span class="nc" id="L136">    }</span>

    @FXML
    public void onLimpar() {
<span class="nc" id="L140">        limparFormulario();</span>
<span class="nc" id="L141">    }</span>

    private void preencherFormulario(Produtor produtor) {
<span class="nc" id="L144">        produtorAtual = produtor;</span>
<span class="nc" id="L145">        txtNome.setText(produtor.getNome());</span>
<span class="nc" id="L146">        txtApelido.setText(produtor.getApelido());</span>
<span class="nc" id="L147">        txtCpf.setText(produtor.getCpf());</span>
<span class="nc" id="L148">        txtRegiao.setText(produtor.getRegiao());</span>
<span class="nc" id="L149">        txtReferencia.setText(produtor.getReferencia());</span>
<span class="nc" id="L150">        txtTelefone.setText(produtor.getTelefone());</span>
<span class="nc" id="L151">    }</span>

    private void limparFormulario() {
<span class="nc" id="L154">        produtorAtual = null;</span>
<span class="nc" id="L155">        txtNome.clear();</span>
<span class="nc" id="L156">        txtApelido.clear();</span>
<span class="nc" id="L157">        txtCpf.clear();</span>
<span class="nc" id="L158">        txtRegiao.clear();</span>
<span class="nc" id="L159">        txtReferencia.clear();</span>
<span class="nc" id="L160">        txtTelefone.clear();</span>
<span class="nc" id="L161">    }</span>

    private void limparFormularioIfSelected(Produtor produtorExcluido) {
<span class="nc bnc" id="L164" title="All 4 branches missed.">        if (produtorAtual != null &amp;&amp; produtorAtual.getId().equals(produtorExcluido.getId())) {</span>
<span class="nc" id="L165">            limparFormulario();</span>
        }
<span class="nc" id="L167">    }</span>

    private void mostrarAlerta(String titulo, String conteudo, Alert.AlertType tipo) {
<span class="nc" id="L170">        Alert alert = new Alert(tipo);</span>
<span class="nc" id="L171">        alert.setTitle(titulo);</span>
<span class="nc" id="L172">        alert.setHeaderText(null);</span>
<span class="nc" id="L173">        alert.setContentText(conteudo);</span>
<span class="nc" id="L174">        alert.showAndWait();</span>
<span class="nc" id="L175">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>